@model TWI.InventoryAutomated.Models.StockCountHeader
@{
    ViewBag.Title = @TWI.InventoryAutomated.Resources.GlobalResource.MsgBatchIterationTitle;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/font-awesome.css" rel="stylesheet" />
<div class="row" style="border:2px #808080 solid;">
    <div style="margin:auto;width:100% !important;max-width:100%;border:2px #808080 solid;">
        <div style="background-color: #808080;color: #ffffff;padding: 5px;height: 30px;" id="topHeading">
            <div style="font-weight:bold">Stock Count - Manager's View </div>
            <a style="margin-top:-24px;float: right;color: white;" href='@Url.Action("Index", "StockCount")'><i class="fa fa-home fa-2x"></i></a>
        </div>
        <div style="float:left !important;width:100% !important;margin: 15px auto 15px;">
            <div style="float:left !important;">
                <div style="float:left;margin-left:15px;">
                    @Html.DropDownListFor(model => model.ID, ViewBag.BatchList as SelectList, new { @class = "form-control", @id = "ddlBatches", @name = "ddlBatches" })
                </div>
            </div>
            <div style="float:left !important;margin-left:5px !important;" class="col-sm-8">
                <div class="field_background1" style="width:100% !important;margin-bottom:5px;">
                    <div class="col-sm-6" style="padding-top:4px;" id="SCDesc">Description: <span style="padding-left:3px;font-weight:400 !important"> @Html.DisplayFor(model => model.SCDesc) </span></div>
                    <div class="col-sm-6" style="padding-top:4px;" id="LocationCode">
                        Location: <span style="padding-left:3px;font-weight:400 !important"> @Html.DisplayFor(model => model.LocationCode)</span>
                    </div>
                </div>
                <div class="field_background1" style="width:100% !important;">
                    <div class="col-sm-6" style="padding-top:4px;" id="TotalItem">
                        Item Lines: <span style="padding-left:3px;font-weight:400 !important">
                            @{
                                var ItemLines = Convert.ToInt32(Model.TotalItemCount);
                            }
                            @Html.DisplayFor(model => ItemLines)
                        </span>
                    </div>
                    <div class="col-sm-6" style="padding-top:4px;" id="Status">
                        Status : <span style="padding-left:3px;font-weight:400 !important">
                            @{ var status = ""; status = Model.Status == "O" ? "Open" : "Closed"; }
                            @Html.DisplayFor(model => status)
                        </span>
                    </div>
                </div>
            </div>
            <div style="float:left;margin-bottom:10px;margin-left:5px !important;">
                <a class="btn btn-primary" style="width:70px;height:55px;padding-left:7px;padding-top:13px;text-align:center;font-weight:bold;" data-toggle="tooltip" title="">Post</a>
            </div>
        </div>
        <div style="float:left !important;width:100% !important;margin:0 15px 5px 30px;padding-right:35px;">
            <div class="row" >
                <div style="float:left;margin-right:10px;">
                    @Html.DropDownList("ZoneCodes", ViewBag.ZoneCodes as SelectList, new { @class = "form-control", @id = "ddlZoneCodes" })
                </div>
                <div style="float:left;margin-right:10px;">
                    @Html.DropDownList("BinCodes", ViewBag.BinCodes as SelectList, new { @class = "form-control", @id = "ddlBinCodes" })
                </div>
                <div style="float:left;margin-right:10px;margin-bottom:10px;">
                    <input type="text" class="form-control" placeholder="Item No" id="txtItemNo" name="txtItemNo" width="80" />
                </div>
                <div style="float:left;margin-bottom:10px;">
                    <a class="btn btn-primary" style="width:50px;height:33px;padding-left:7px;padding-top:5px;text-align:center;font-weight:bold;" data-toggle="tooltip" title="">Filter</a>
                </div>
                <div style="float:left;margin-bottom:10px;margin-left:10px">
                    <a class="btn btn-primary" style="width:70px;height:33px;padding-left:7px;padding-top:5px;text-align:center;font-weight:bold;" data-toggle="tooltip" title="">Fill Qty</a>
                </div>
                <div style="float:right;margin-bottom:10px;margin-right:25px;">
                    <a class="btn btn-primary fa fa-search" style="width:50px;height:33px;padding-left:7px;padding-top:5px;text-align:center;font-weight:bold;" data-toggle="tooltip" title=""></a>
                </div>
                <div style="float:right;margin-right:10px;margin-bottom:10px;">
                    <input type="text" placeholder="enter value" id="txtValue" name="txtValue" width="50" />
                </div>
                <div style="float:right;margin-right:10px;">
                    <select id="ddlOperator" class="form-control">
                        <option value="0"><</option>
                        <option value="1">=</option>
                        <option value="2"><=</option>
                        <option value="3">></option>
                        <option value="2">>=</option>
                    </select>
                </div>
            </div>
        </div>
        <div style="float:left;width:100%;margin:auto 15px;padding-right:13px;">
                <div class="row col-sm-12 table-responsive" style="max-width:100% !important;">
                    <table id="HeaderTable" class="table table-striped table-responsive table-bordered"></table>
                </div>
            </div>
        </div>
    </div>

<link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

@section scripts{

    <script type="text/javascript" charset="utf-8" src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>

    <script>
        var datatable; var rows_selected = [];
        var editor;
        
        $(document).ready(function () {

            var selectedbatch = $("#ddlBatches").val();
            RefreshManagerView(selectedbatch);

            $("#ddlBatches").change(function () {
                $.ajax({
                    url: "/StockCount/GetStockCountHeaderDetailByID?ID=" + $("#ddlBatches").val(),
                    type: "GET",
                    datatype: "json",
                    async: true,
                    success: function (data) {
                        //console.log(data);
                        if (data.data === null) {
                            $("#LocationCode").html('Location: '); $("#SCDesc").html('Description : '); $("#TotalItem").html('Item Lines: ');
                            $("#Status").html('Status : ');
                        }
                        else {
                            $("#LocationCode").html('Location: <span style="padding-left:10px;font-weight:400 !important">' + data.data.LocationCode + ' </span>');
                            $("#SCDesc").html('Description: <span style="padding-left:10px;font-weight:400 !important">' + data.data.SCDesc + ' </span>');
                            $("#TotalItem").html('Item Lines: <span style="padding-left:10px;font-weight:400 !important">' + data.data.TotalItemCount + '</span>');
                            $("#Status").html('Status : <span style="padding-left:10px;font-weight:400 !important">' + data.data.Status + ' </span>');
                        }
                        RefreshManagerView($("#ddlBatches").val());
                    }
                });
            });

            //$('#HeaderTable tbody').on('click', 'input[type="checkbox"]', function (e) {
            //    var $row = $(this).closest('tr');

            //    // Get row data
            //    var data = datatable.row($row).data();

            //    // Get row ID
            //    var rowId = data[0];

            //    // Determine whether row ID is in the list of selected row IDs 
            //    var index = $.inArray(rowId, rows_selected);

            //    // If checkbox is checked and row ID is not in list of selected row IDs
            //    if (this.checked && index === -1) {
            //        rows_selected.push(rowId);

            //        // Otherwise, if checkbox is not checked and row ID is in list of selected row IDs
            //    } else if (!this.checked && index !== -1) {
            //        rows_selected.splice(index, 1);
            //    }

            //    if (this.checked) {
            //        $row.addClass('selected');
            //    } else {
            //        $row.removeClass('selected');
            //    }

            //    // Update state of "Select all" control
            //    updateDataTableSelectAllCtrl(datatable);

            //    // Prevent click event from propagating to parent
            //    e.stopPropagation();
            //});

            //// Handle click on table cells with checkboxes
            //$('#HeaderTable').on('click', 'tbody td, thead th:first-child', function (e) {
            //    $(this).parent().find('input[type="checkbox"]').trigger('click');
            //});

            //$('thead input[name="select_all"]', datatable.table().container()).on('click', function (e) {
            //    if (this.checked) {
            //        $('#HeaderTable tbody input[type="checkbox"]:not(:checked)').trigger('click');
            //    } else {
            //        $('#HeaderTable tbody input[type="checkbox"]:checked').trigger('click');
            //    }

            //    // Prevent click event from propagating to parent
            //    e.stopPropagation();
            //});

            //datatable.on('draw', function () {
            //    // Update state of "Select all" control
            //    updateDataTableSelectAllCtrl(datatable);
            //});
        });

        function RefreshManagerView(batchId) {
            var currentCult = getCookie("Language");
            var Path = FetchPathforCultureFile(currentCult);
            var dataset;
            var my_columns = [];

            $.ajax({
                url: "/StockCount/GetManagerViewData?ID=" + batchId,
                datatype: "json",
                type: "GET",
                success: function (data) {
                    //console.log(data);
                    if (data.length === 0) {
                        datatable.table().clear();
                        datatable = $("#HeaderTable").DataTable({
                            "destroy": true, data: dataset,
                            "language": {
                                "emptyTable": "No data found for the selected batch",
                                "url" : Path
                            },
                            "fnDrawCallback": function () {
                                $("#HeaderTable thead").remove();
                            }
                        });
                    }
                    else {

                        //console.log(data);
                        dataset = data;

                        $.each(data[0], function (key, value) {
                            var my_item = {};
                            my_item.data = key;
                            my_item.title = key;
                            my_columns.push(my_item);
                        });

                        datatable = $('#HeaderTable').DataTable({
                            "destroy": true,
                            data: dataset,
                            'columnDefs': [
                                {
                                    'targets': [0],
                                    'searchable': false,
                                    'orderable': false,
                                    'width': '1%',
                                    'className': 'dt-body-center'
                                },
                                {
                                    'targets': [1],
                                    'searchable': false,
                                    'orderable': false,
                                    'width': '5%',
                                    'className': 'dt-body-center'
                                },
                                {
                                    'targets': [5],
                                    'searchable': false,
                                    'orderable': false,
                                    'width': '25%'
                                },
                                {
                                    'targets': [my_columns.length-1],
                                    'searchable': false,
                                    'orderable': false,
                                    'width': '5%',
                                    'className': 'dt-body-center'
                                }
                            ],
                            'select': { 'style': 'multi' },
                            'order': [[1, 'asc']],
                            "columns": my_columns
                        });
                    }
                }
            });
        }

        //function updateDataTableSelectAllCtrl(table) {
        //    var $table = table.table().node();
        //    var $chkbox_all = $('tbody input[type="checkbox"]', $table);
        //    var $chkbox_checked = $('tbody input[type="checkbox"]:checked', $table);
        //    var chkbox_select_all = $('thead input[name="select_all"]', $table).get(0);

        //    // If none of the checkboxes are checked
        //    if ($chkbox_checked.length === 0) {
        //        chkbox_select_all.checked = false;
        //        if ('indeterminate' in chkbox_select_all) {
        //            chkbox_select_all.indeterminate = false;
        //        }

        //        // If all of the checkboxes are checked
        //    } else if ($chkbox_checked.length === $chkbox_all.length) {
        //        chkbox_select_all.checked = true;
        //        if ('indeterminate' in chkbox_select_all) {
        //            chkbox_select_all.indeterminate = false;
        //        }

        //        // If some of the checkboxes are checked
        //    } else {
        //        chkbox_select_all.checked = true;
        //        if ('indeterminate' in chkbox_select_all) {
        //            chkbox_select_all.indeterminate = true;
        //        }
        //    }
        //}

    </script>
}
