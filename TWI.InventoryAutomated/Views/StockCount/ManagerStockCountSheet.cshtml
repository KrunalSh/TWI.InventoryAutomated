@model TWI.InventoryAutomated.Models.StockCountModel
@{
    ViewBag.Title = @TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/font-awesome.css" rel="stylesheet" />

<style>
    .showdialog {
        display: block;
    }

    input {
        margin: .4rem;
    }

    .block {
        display: block;
    }
</style>

<div class="row" style="border:2px #808080 solid;">
    <div style="margin:auto;width:100% !important;max-width:100%;border:2px #808080 solid;">
        <div style="background-color: #808080;color: #ffffff;padding: 5px;height: 30px;" id="topHeading">
            <div style="font-weight:bold">Stock Count - Manager's View </div>
            <a style="margin-top:-24px;float: right;color: white;" href='@Url.Action("Index", "StockCount")'><i class="fa fa-home fa-2x"></i></a>
        </div>
        <div style="float:left !important;width:100% !important;margin: 15px auto 30px;">
            <div style="float:left !important;">
                <div style="float:left;margin-left:15px;">
                    @Html.DropDownListFor(model => model.ID, ViewBag.BatchList as SelectList, new { @class = "form-control", @id = "ddlBatches", @name = "ddlBatches" })
                </div>
            </div>
            <div style="float:left !important;margin-left:5px !important;" class="col-sm-10">
                <div class="field_background1" style="width:100% !important;margin-bottom:5px;">
                    <div class="col-sm-5" style="padding-top:4px;" id="SCDesc">@TWI.InventoryAutomated.Resources.GlobalResource.Description: <span style="padding-left:3px;font-weight:400 !important"> @Html.DisplayFor(model => model.SCDesc) </span></div>
                    <div class="col-sm-4" style="padding-top:4px;" id="LocationCode">
                        @TWI.InventoryAutomated.Resources.GlobalResource.Location: <span style="padding-left:3px;font-weight:400 !important"> @Html.DisplayFor(model => model.LocationCode)</span>
                    </div>
                    <div class="col-sm-3" style="padding-top:4px;" id="Status">
                        @TWI.InventoryAutomated.Resources.GlobalResource.Status: <span style="padding-left:3px;font-weight:400 !important"> @Html.DisplayFor(model => model.Status) </span>
                    </div>
                </div>
                <div class="field_background1" style="width:100% !important;">
                    <div class="col-sm-5" style="padding-top:4px;" id="TotalItem">
                        @TWI.InventoryAutomated.Resources.GlobalResource.NAVEntries: <span style="padding-left:3px;font-weight:400 !important">
                            @{
                                var ItemLines = Convert.ToInt32(Model.TotalItemCount);
                            }
                            @Html.DisplayFor(model => ItemLines)
                        </span>
                    </div>
                    <div class="col-sm-4" style="padding-top:4px;" id="AdjTotalItem">
                        @TWI.InventoryAutomated.Resources.GlobalResource.ADJEntries: <span style="padding-left:3px;font-weight:400 !important">
                            @Html.DisplayFor(model => model.TotalAdjustmentItems)
                        </span>
                    </div>
                    <div class="col-sm-3" style="padding-top:4px;" id="Finalized">
                        @TWI.InventoryAutomated.Resources.GlobalResource.FinalQty: <span style="padding-left:3px;font-weight:400 !important">
                            @Html.DisplayFor(model => model.FinalizedLines)
                        </span>
                    </div>
                </div>
            </div>
            @*<div style="float:left;margin-bottom:10px;margin-left:5px !important;">
                    <a class="btn btn-primary" style="width:70px;height:55px;padding-left:7px;padding-top:13px;text-align:center;font-weight:bold;" data-toggle="tooltip" title="">Post</a>
                </div>*@
        </div>
        <div style="float:right !important;width:100% !important;margin:0 5px 0px 15px;padding-right:0px;display:none;" id="divfilters">
            <div class="row col-sm-12">
                <div style="float:left;margin-bottom:10px;margin-left:10px">
                    <a class="btn btn-primary" href="http://twiqv02/QvAJAXZfc/opendoc.htm?document=it%20testing%5Cstock%20count%20analysis.qvw&lang=en-US&host=QVS%40twiqv02" target="_blank" style="width:120px;height:33px;padding-left:7px;padding-top:5px;text-align:center;font-weight:bold;margin-left:10px;" data-toggle="tooltip" title="">Batch Insight</a>
                    <a class="btn btn-primary" style="width:120px;height:33px;padding-left:7px;padding-top:5px;text-align:center;font-weight:bold;margin-left:10px;" data-toggle="tooltip" title="" id="FillQty" onclick="FillQty();">Fill Final Qty</a>
                    <a class="btn btn-primary" style="width:120px;height:33px;padding-left:7px;padding-top:5px;text-align:center;font-weight:bold;margin-left:10px;" data-toggle="tooltip" title="" id="FillQty" onclick="ClearFinalQty();">Clear Final Qty</a>
                </div>
                <div style="float:right;margin-bottom:10px;">
                    <a class="btn btn-primary" style="width:50px;height:33px;padding-left:7px;padding-top:5px;text-align:center;font-weight:bold;" data-toggle="tooltip" onclick="FilterList();" title="">Filter</a>
                </div>
                <div style="float:right;margin-right:10px;margin-bottom:10px;margin-top:-5px;">
                    <input type="text" class="form-control" placeholder="enter value" id="txtValue" name="txtValue" style="width:100px !important;" />
                </div>
                <div style="float:right;margin-right:10px;">
                    <select id="ddlOperator" class="form-control">
                        <option value="0"></option>
                        <option value="1"><</option>
                        <option value="2">=</option>
                        <option value="3"><=</option>
                        <option value="4">></option>
                        <option value="5">>=</option>
                    </select>
                </div>
                <div style="float:right;margin-right:10px;margin-bottom:10px;">
                    <input class="form-control" type="text" placeholder="Item No" id="txtItemNo" name="txtItemNo" style="width:200px; !important;margin-top:0px;" />
                </div>
                <div style="float:right;margin-right:10px;">
                    @Html.DropDownList("BinCodes", ViewBag.BinCodes as SelectList, new { @class = "form-control", @id = "ddlBinCodes" })
                </div>
                <div style="float:right;margin-right:10px;">
                    @Html.DropDownList("ZoneCodes", ViewBag.ZoneCodes as SelectList, new { @class = "form-control", @id = "ddlZoneCodes" })
                </div>
            </div>
        </div>
        @*padding-right:13px;class="row col-sm-12 table-responsive"*@
        <div id="divtable" style="float:left;width:100%;margin-right:10px;padding-left:30px; " class="row col-sm-12 table-responsive">
            <div style="max-width:100% !important;">
                <table id="HeaderTable" class="table table-striped table-bordered"></table>
            </div>
        </div>
        <div class="row col-sm-12" style='display:none;margin:80px 10px 10px 10px; padding:5px 5px 5px 10px;border:solid 1px #808080; border-radius:10px;background-color: #eae7e7!important;color:black;height:40px !important;width:99% !important;font-family:Calibri;font-size:18px;font-weight:400;' id="divNoData">No Item Allocation done for this batch.</div>
        <div id="filldialog" style="float:left;width:400px;">
            <div style="float:left;width:400px;margin:5px 5px 15px 5px;">
                <div style="float:left;"><label for="rdbSingle"><input type="radio" name="rdbSource" id="rdbSingle" value="" checked /><span style="padding-left:5px;font-weight:600;">Single Source</span></label></div>
                <div style="float:left;margin-left:30px;">
                    <select id="ddlCounts" name="ddlCounts" class="form-control" style="width:160px;"></select>
                </div>
            </div>
            <div style="float:left;height:3px;border-bottom:1px solid #808080;width:370px;">&nbsp;</div>
            <div style="float:left;width:400px;margin:5px 5px 15px 5px;">
                <div style="float:left;"><label for="rdbMultiple"><input type="radio" name="rdbSource" id="rdbMultiple" value="" /><span style="padding-left:5px;font-weight:600;">Multiple Source</span></label></div>
                <div style="float:left;margin-left:20px;">
                    <label class="block "><input type="radio" name="radArthemeticOperations" id="rdbMin" value="MI" checked /><span style="padding-left:5px;font-weight:400;">Min.</span></label>
                    <label class="block "><input type="radio" name="radArthemeticOperations" id="rdbMax" value="MA" /><span style="padding-left:5px;font-weight:400;">Max.</span></label>
                    <label class="block "><input type="radio" name="radArthemeticOperations" id="rdbAvg" value="AV" /><span style="padding-left:5px;font-weight:400;">Avg. </span></label>
                </div>
                <div style="float:left;margin-left:20px;" id="chkCountGroup">
                    @*<label class="block"><input type="checkbox" name="chkCountGroup" checked /><span style="padding-left:5px;font-weight:400;"> Count 1 </span> </label>
                        <label class="block"><input type="checkbox" name="chkCountGroup" /><span style="padding-left:5px;font-weight:400;"> Count 2 </span></label>
                        <label class="block"><input type="checkbox" name="chkCountGroup" /><span style="padding-left:5px;font-weight:400;"> Count 3 </span></label>
                        <label class="block"><input type="checkbox" name="chkCountGroup" /><span style="padding-left:5px;font-weight:400;"> Count 4 </span></label>*@
                </div>
            </div>
            <div style="float:left;height:3px;border-bottom:1px solid #808080;width:370px;">&nbsp;</div>
            <div style="float:left;width:400px;margin:5px 5px 15px 5px;">
                <div style="float:left;"><label for="chkIncludeZero"><input type="checkbox" name="chkInclude" id="chkIncludeZero" value="" /><span style="padding-left:5px;font-weight:600;">Include Zero(s) </span></label></div>
                <div style="float:right;margin-right:35px;" class="form-group">
                    <input type="button" class="btn btn-primary" style="width:70px;height:30px;padding-top:4px;padding-left:11px;font-weight:bold;" onclick="ValidateQuantitiesForPush();" value="Fill Qty">
                </div>
            </div>
        </div>

        <div id="divUpdateQty" style="float:left;width:200px !important">
            <div style="float:left;"><input type="text" id="txtQty" class="form-control customWidth90px" maxlength="7" placeholder="Enter Qty" /><input type="hidden" id="hdnId" value="0" /></div>
            <div style="float:left;"><input type="submit" onclick="SaveManualQty();" value="@TWI.InventoryAutomated.Resources.GlobalResource.Save" class="btn btn-primary" /></div>
        </div>
        <div></div>
    </div>
</div>

<link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

@section scripts{

    <script src="//cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="~/Scripts/jquery-editable-select.min.js"></script>
    <script>
        var datatable; var rows_selected = [];
        var editor; var Popup;

        $(document).ready(function () {

            var selectedbatch = $("#ddlBatches").val();

            //$.ajax({
            //    url: "/StockCount/GetItemListByID?SCID=" + $("#ddlBatches").val(),
            //    type: "GET",
            //    datatype: "Json",
            //    success: function (data) {
            //        console.log(data);
            //        $("#txtItemNo").autocomplete({
            //            source: data
            //        });
            //    }
            //});

            RefreshManagerView(selectedbatch,'%','%','%',"");

            $("#filldialog").hide();
            $("#divUpdateQty").hide();

            datatable = $("#HeaderTable");

            $('#HeaderTable tbody').on('click', 'input[type="checkbox"]', function (e) {
                var $row = $(this).closest('tr');

                // Get row data
                var data = datatable.row($row).data();

                // Get row ID
                var rowId = data[0];

                // Determine whether row ID is in the list of selected row IDs
                var index = $.inArray(rowId, rows_selected);

                // If checkbox is checked and row ID is not in list of selected row IDs
                if (this.checked && index === -1) {
                    rows_selected.push(rowId);

                    // Otherwise, if checkbox is not checked and row ID is in list of selected row IDs
                } else if (!this.checked && index !== -1) {
                    rows_selected.splice(index, 1);
                }

                if (this.checked) {
                    $row.addClass('selected');
                } else {
                    $row.removeClass('selected');
                }

                // Update state of "Select all" control
                updateDataTableSelectAllCtrl(datatable);

                // Prevent click event from propagating to parent
                e.stopPropagation();
            });

            // Handle click on table cells with checkboxes
            $('#HeaderTable').on('click', 'tbody td:first-child, thead th:first-child', function (e) {
                $(this).parent().find('input[type="checkbox"]').trigger('click');
            });

            //datatable.table().container()
            //, datatable.table().container
            $('thead input[name="select_all"]').on('click', function (e) {
                if (this.checked) {
                    $('#HeaderTable tbody input[type="checkbox"]:not(:checked)').trigger('click');
                } else {
                    $('#HeaderTable tbody input[type="checkbox"]:checked').trigger('click');
                }

                // Prevent click event from propagating to parent
                e.stopPropagation();
            });

            datatable.on('draw', function () {
                // Update state of "Select all" control
                updateDataTableSelectAllCtrl(datatable);
            });

            $("#ddlBatches").change(function () {

                if ($("#ddlBatches").val() === "-1") {
                    ShowDialog('@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.MsgBatchSelectionMandatory)', '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView)');
                    //alert("Batch Selection is Mandatory");
                    return;
                }
                else {
                    window.location.href = "/StockCount/ManagerStockCountSheet?ID=" + $("#ddlBatches").val();
                }
            });

            $("#ddlZoneCodes").change(function () {

                var zoneval = $("#ddlZoneCodes").val();

                if (zoneval === "-1") {
                    $("#ddlBinCodes").empty();
                    $("#txtItemNo").empty();
                    var binopt = new Option("-- Select Bin --", "-1");
                    $("#ddlBinCodes").append(binopt);
                }
                else {

                    $.ajax({
                        url: "/StockCount/GetBinsByZone",
                        type: "GET",
                        datatype: "Json",
                        data: { Zone: zoneval,ID: $("#ddlBatches").val() },
                        success: function (data) {
                            //console.log(data);
                            $("#ddlBinCodes").empty();
                            $("#txtItemNo").empty();
                            for (var i = 0; i < data.length; i++) {
                                var binopt = new Option(data[i], data[i]);
                                $("#ddlBinCodes").append(binopt);
                            }
                        }
                    });
                }
            });

            $("#ddlBinCodes").change(function () {

                var bincode = $("#ddlBinCodes").val();
                if (bincode === "-1") {
                    $("#txtItemNo").empty();
                }
                else {

                    $.ajax({
                        url: "/StockCount/GetItemsByBin",
                        type: "GET",
                        datatype: "Json",
                        data: { ID: $("#ddlBatches").val(), BinCode: bincode },
                        success: function (data) {
                            console.log(data);
                            $("#txtItemNo").autocomplete({
                                source:data
                            });
                        }
                    });
                }
            });

            $("#txtQty").keypress(function (e) {
                if (e.which === 46) {
                    if ($(this).val().indexOf('.') !== -1) {
                        return false;
                    }
                }

                if (e.which !== 8 && e.which !== 0 && e.which !== 46 && e.which !== 13 && (e.which < 48 || e.which > 57)) {
                    return false;
                }

            });

            $("#txtValue").keypress(function (e) {
                if (e.which === 46) {
                    if ($(this).val().indexOf('.') !== -1) {
                        return false;
                    }
                }

                if (e.which !== 8 && e.which !== 0 && e.which !== 46 && e.which !== 13 && (e.which < 48 || e.which > 57)) {
                    return false;
                }

            });

            $("#ddlOperator").change(function () {
                if ($("#ddlOperator").val() === "0") { $("#txtValue").val('');  }
            });

        });

        function RefreshManagerView(batchId,ZoneCode,BinCode,ItemNo,Qtyfilter) {
            var currentCult = getCookie("Language");
            var Path = FetchPathforCultureFile(currentCult);
            var dataset;
            var my_columns = [];

            $.ajax({
                //url: "/StockCount/GetManagerViewData?ID=" + batchId,
                url: "/StockCount/GetManagerViewData",
                datatype: "json",
                type: "GET",
                data: { ID: batchId, Zone: ZoneCode, Bin: BinCode, Item: ItemNo, QtyFilter: Qtyfilter },
                success: function (data) {
                    if (data.length === 0) {
                        //$("#divNoData").show();
                        $("#divfilters").show();
                        $("#divtable").hide();

                        //dataset = data;
                        //datatable = $("#HeaderTable").DataTable({
                        //    "destroy": true, data: dataset,
                        //    "language": {
                        //        "emptyTable": "No data found for the selected batch",
                        //        "url" : Path
                        //    },
                        //    "fnDrawCallback": function () {
                        //        $("#HeaderTable thead").remove();
                        //    }
                        //});
                    }
                    else {
                        $("#divNoData").hide();
                        $("#divtable").show();
                        $("#divfilters").show();
                        //console.log(data);
                        dataset = data;

                        $.each(data[0], function (key, value) {
                            var my_item = {};
                            my_item.data = key;
                            my_item.title = key;
                            my_columns.push(my_item);
                        });

                        datatable = $('#HeaderTable').DataTable({
                            "destroy": true,
                            data: dataset,
                            'columnDefs': [
                                {
                                    'targets': [0],
                                    'searchable': false,
                                    'orderable': false,
                                    'className': 'datatable_col5PercR',
                                    "data" : "DocType"
                                },
                                {
                                    'targets': [1],
                                    'searchable': false,
                                    'orderable': false,
                                    'className': 'datatable_col5PercR'
                                },
                                {
                                    'targets': [2],
                                    'searchable': false,
                                    'orderable': false,
                                    'className': 'datatable_col5PercR'
                                },
                                {
                                    'targets': [3],
                                    'searchable': false,
                                    'orderable': false,
                                    'className': 'datatable_col5PercR'
                                },
                                {
                                    'targets': [4],
                                    'searchable': true,
                                    'orderable': false,
                                    'className': 'datatable_col10PercR'
                                },
                                {
                                    'targets': [5],
                                    'searchable': false,
                                    'orderable': false,
                                    'className': 'datatable_col5PercR'
                                },
                                {
                                    'targets': [6],
                                    'searchable': false,
                                    'orderable': false,
                                    'className': 'datatable_col5PercR'
                                },
                                {
                                    'targets': [7],
                                    'searchable': false,
                                    'orderable': false,
                                    'className': 'datatable_col5PercR'
                                },
                                {
                                    'targets': [8],
                                    'searchable': false,
                                    'orderable': true,
                                    'width': '5%',
                                    'className': 'datatable_col5PercR',
                                    "data": "FinalQty"
                                },
                                {
                                    'targets': [9],
                                    'searchable': false,
                                    'orderable':false,
                                    'width': '5%',
                                    'className': 'datatable_col5PercR',
                                    "data": "ID",
                                    "visible" : false
                                },
                                {
                                    'targets': [my_columns.length],
                                    'searchable': false,
                                    'orderable': false,
                                    "data": "ID",
                                    "className": "datatable_col5PercR",
                                    'render': function (data, type, full, meta) {
                                        return '<input type="checkbox"><input id="ID" type="hidden" value="' + data + '">&nbsp;&nbsp;<a class="btn btn-primary fa fa-edit" style="float:right;width:20px!important;height:20px!important;vertical-align:middle!important;padding-top:2px;padding-left:4px;" alt="" onclick="UpdateFinalQty('+ data +');" ></a> ';
                                    }
                                }
                            ],
                            'select': { 'style': 'multi' },
                            'order': [[1, 'asc']],
                            "columns": my_columns
                        });
                    }
                }
            });
        }

        function updateDataTableSelectAllCtrl(table) {
            var $table = table.table().node();
            var $chkbox_all = $('tbody input[type="checkbox"]', $table);
            var $chkbox_checked = $('tbody input[type="checkbox"]:checked', $table);
            var chkbox_select_all = $('thead input[name="select_all"]', $table).get(0);

            // If none of the checkboxes are checked
            if ($chkbox_checked.length === 0) {
                chkbox_select_all.checked = false;
                if ('indeterminate' in chkbox_select_all) {
                    chkbox_select_all.indeterminate = false;
                }

                // If all of the checkboxes are checked
            } else if ($chkbox_checked.length === $chkbox_all.length) {
                chkbox_select_all.checked = true;
                if ('indeterminate' in chkbox_select_all) {
                    chkbox_select_all.indeterminate = false;
                }

                // If some of the checkboxes are checked
            } else {
                chkbox_select_all.checked = true;
                if ('indeterminate' in chkbox_select_all) {
                    chkbox_select_all.indeterminate = true;
                }
            }
        }

        function ClearFinalQty() {
            $.ajax({
                url: "/StockCount/ClearFinalQty?ID=" + $("#ddlBatches").val(),
                type: "GET",
                datatype: "JSON",
                success: function (data) {
                    if (data.success) {
                        //alert(data.message);
                        ShowDialog(data.message, '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.ClearFinalQty)');
                        RefreshManagerView($("#ddlBatches").val(), '%', '%', '%',"");
                    }
                    else {
                        ShowDialog(data.message, '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.ClearFinalQty)');
                    }
                },
                error: function (data) {
                        ShowDialog(data.message, '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.ClearFinalQty)');
                }
            });
        }

        function FillQty() {

            var count = 0;
            $('#HeaderTable tbody').find('tr').each(function () {
                var row = $(this);

                if (row.find('input[type="checkbox"]').is(':checked')) {
                    count++;
                }
            });

            if (count > 0) {
                $("#filldialog").show();

                $.ajax({
                    url: "/StockCount/GetCountsByID?ID=" + $("#ddlBatches").val(),
                    type: "GET",
                    datatype: "Json",
                    success: function (data) {
                        //console.log(data);
                        $("#ddlCounts").empty();
                        $("#chkCountGroup").empty();
                        for (var i = 0; i < data.length; i++) {
                            var countopt = new Option(data[i].SCIterationName, data[i].SCIterationID);
                            var htmlContent = '';
                            $("#ddlCounts").append(countopt);

                            htmlContent += '<label class="block"><input type="checkbox" name="chkCountGroup" value="' + data[i].SCIterationID + '" /><span style="padding-left:5px;font-weight:400;">' + data[i].SCIterationName + '</span></label>';
                            $("#chkCountGroup").append(htmlContent);
                        }
                    }
                });

                Popup = $("#filldialog").dialog({
                    modal: true, title: '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - "+ TWI.InventoryAutomated.Resources.GlobalResource.FillQty)', zIndex: 10000, autoOpen: true, width: 400, resizable: false
                    //buttons: {
                    //    Ok: function () {
                    //        $(this).dialog("close");
                    //    }
                    //}

                });
            }
            else
            {
                ShowDialog('@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.MsgItemSelection)', '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView)' + ' - ' + '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.FillQty)');
                //alert("Kindly select atleast one item to proceed");
                return;
            }
        }

        function FilterList() {
            var batchId = $("#ddlBatches").val();
            var ZoneCode = $("#ddlZoneCodes").val();
            var BinCode = $("#ddlBinCodes").val();
            var ItemNo = $("#txtItemNo").val().split(" - ")[0];
            var QtyFilter = '';

            var filterselected = $("#ddlOperator").val();

            if (filterselected !== '0' && $("#txtValue").val() === '') {
                ShowDialog('@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.MsgFinalQtyValueMandatory)', '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView)' + ' - ' + '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.Filter)');
                //alert('Kindly enter a value to filter final qty');
                return;
            }
            else {
                if (filterselected === '0') { QtyFilter = ''; }
                if (filterselected === '1') { QtyFilter = ' And SCD.PhyicalQty < ' + $("#txtValue").val(); }
                if (filterselected === '2') { QtyFilter = ' And SCD.PhyicalQty = ' + $("#txtValue").val(); }
                if (filterselected === '3') { QtyFilter = ' And SCD.PhyicalQty <= ' + $("#txtValue").val(); }
                if (filterselected === '4') { QtyFilter = ' And SCD.PhyicalQty > ' + $("#txtValue").val(); }
                if (filterselected === '5') { QtyFilter = ' And SCD.PhyicalQty >= ' + $("#txtValue").val(); }
            }

            if (batchId === "-1") {

                ShowDialog('@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.MsgBatchSelectionMandatory)', '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView)' + ' - ' + '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.Filter)');
                //alert("Batch Selection is mandatory");
                return;
            }

            if (ZoneCode === "-- Select Zone --") { ZoneCode = "%"; }

            if (BinCode === "-- Select Bin --") { BinCode = "%"; }

            if (ItemNo === "") { ItemNo = "%"; }

            RefreshManagerView(batchId, ZoneCode, BinCode, ItemNo,QtyFilter);
        }

        function ValidateQuantitiesForPush() {
            //alert("Push Final Qty");
            var RowID = []; var count = 0;
            //var selectedbatch = $("#ddlBatches").val();
            $('#HeaderTable tbody').find('tr').each(function () {
                var row = $(this);
                if (row.find('input[type="checkbox"]').is(':checked')) {
                    count++;
                }
            });

            if (count > 0) {
                RowID.length = count;
                var colcount = 0; var rowdata = ''; var itemstring = '';
                var itemstringstart = '';
                count = 0;
                if ($("#rdbSingle").is(':checked')) {
                    itemstringstart = $("#ddlBatches").val() + ':' + 'S:' + $("#ddlCounts").val() + ':';
                    if ($("#chkIncludeZero").is(':checked')) { itemstringstart += '1:'; } else { itemstringstart += '0:'; }
                    //alert(itemstringstart);
                }
                else {
                    var checkboxcount = 0;
                    var iterationvalues = '';
                    $("#chkCountGroup").find('input[type="checkbox"]').each(function () {
                        var chk = $(this);
                        if (chk.is(':checked')) { checkboxcount++; iterationvalues += $(this).val() + '/'; }
                    });

                    if (checkboxcount === 0) {
                        ShowDialog('@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.MsgCountSelectionForMultipleSource)', '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.FillQty)'); return;
                        /*alert("Kindly select atleast one count source for multiple source option");*/
                    }
                    else if (checkboxcount < 2) {
                        ShowDialog('@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.MsgMultipleCountSelection)', '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.FillQty)'); return;
                        //alert("Kindly select atleast two count sources to generate final Qty using selected Operation"); return;
                    }

                    itemstringstart = $("#ddlBatches").val() + ':' + 'M:';
                    if ($("#rdbMin").is(':checked')) { itemstringstart += 'MI:'; }
                    else if ($("#rdbMax").is(':checked')) { itemstringstart += 'MA:'; }
                    else if ($("#rdbAvg").is(':checked')) { itemstringstart += 'AV:'; }
                    if ($("#chkIncludeZero").is(':checked')) { itemstringstart += '1:'; } else { itemstringstart += '0:'; }

                    itemstringstart += iterationvalues.substring(0, iterationvalues.length - 1) + ':';
                    //alert(itemstringstart);
                }

                $('#HeaderTable tbody').find('tr').each(function () {
                    var row = $(this);
                    if (row.find('input[type="checkbox"]').is(':checked')) {
                        colcount = 0;
                        rowdata = '';
                        row.find('td').each(function () {
                            var col = $(this);
                            //colcount !== 0 &&
                            if (colcount !== 4 && colcount < 8) {
                                rowdata += col.html() + ':';
                            }
                            colcount++;
                        });
                        RowID[count] = itemstringstart + rowdata;
                        //alert(RowID[count]);
                        count++;
                    }
                });

                $.ajax({
                    url: "/StockCount/ValidateDataValues?ID=" + RowID,
                    type: "GET",
                    datatype: "Json",
                    success: function (data) {
                        //alert(data);
                        if (data.success) {
                            PushFinalQty(RowID);
                            RefreshManagerView($("#ddlBatches").val(), "%", "%", "%","");
                        }
                        else {
                            $('<div></div>').html("<div><h5>" + data.message + "</h5></div>").dialog({
                                title: '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - "+ TWI.InventoryAutomated.Resources.GlobalResource.FillQty)', modal: true, width: 400, resizable: false, autoOpen: true,
                                buttons: {
                                    Yes: function () {
                                        PushFinalQty(RowID);
                                        RefreshManagerView($("#ddlBatches").val(), "%", "%", "%","");
                                        $(this).dialog("close");
                                    },
                                    NO: function () {
                                        $(this).dialog("close");
                                    }
                                }
                            });
                        }
                    }
                });
            }

            Popup.dialog('close');
        }

        function PushFinalQty(RowID) {

             $.ajax({
                    url: "/StockCount/PushFinalQty?ID=" + RowID,
                    type: "GET",
                    datatype: "Json",
                    success: function (data) {
                        //alert(data);
                        ShowDialog(data, '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.FillQty)');
                        RefreshManagerView($("#ddlBatches").val(), "%", "%", "%","");
                    }
                });
        }

        function UpdateFinalQty(ID) {
            $("#txtQty").empty();
            $("#hdnId").val(ID);

            Popup = $("#divUpdateQty").dialog({
                modal: true, title: '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.FillQty)', zIndex: 10000, autoOpen: true, width: 200,height:100, resizable: false
                //buttons: {
                //    Ok: function () {
                //        $(this).dialog("close");
                //    }
                //}

            });
            //alert('Edit Button Clicked, ID:' + ID);
        }

        function SaveManualQty() {
            var selectedId = $("#hdnId").val();
            //alert(selectedId);
            var rows = datatable.table().data();
            //console.log(rows);
            rows.each(function (value, index) {
                //rowdata = datatable.row(index).data();
                if (value['ID'] === selectedId) {

                    var teamId = $("#ddlBatches").val();

                    $.ajax({
                        url: '/StockCount/UpdateFinalQty',
                        type: 'GET',
                        datatype: 'Json',
                        data: { TeamID: teamId, ItemNo: value['Item No'], BinCode: value['Bin Code'], LotNo: value['Lot No'], Expdate: value['Expiry Date'], Qty: $("#txtQty").val() },
                        success: function (data) {
                            if (data.success) {
                                ShowDialog(data.message, '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.FillQty)');
                                $("#txtQty").empty();
                                RefreshManagerView($("#ddlBatches").val(), "%", "%", "%","");
                                Popup.dialog('close');
                            }
                        },
                        error: function (data) {
                            ShowDialog(data, '@Html.Raw(TWI.InventoryAutomated.Resources.GlobalResource.SCManagerView + " - " + TWI.InventoryAutomated.Resources.GlobalResource.FillQty)');
                        }
                    });
                }
            });
        }

        function Cancelbutton() {
            Popup.dialog('close');
        }

        function ShowDialog(message, formtitle) {
            $('<div></div>').appendTo('body')
                .html("<div><h5>" + message + "</h5></div>")
                .dialog({
                    modal: true, title: formtitle, zIndex: 10000, autoOpen: true, width: 500, resizable: true,
                    buttons: { Ok: function () { $(this).dialog("close"); } }
                });
        }

    </script>

}
